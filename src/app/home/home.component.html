<mgl-map
  [style]="mapParams.style"
  [zoom]="[mapParams.zoom]"
  [center]="[mapParams.center[0], mapParams.center[1]]"
  (mapLoad)="mapLoad($event)"
  [cursorStyle]="cursorStyle"
>
  <mgl-control mglNavigation></mgl-control>
  <mgl-control mglFullscreen></mgl-control>
  <mgl-control mglGeolocate
   [positionOptions]="{ enableHighAccuracy: true }"
   [trackUserLocation]="true" >
  </mgl-control>

  <mgl-control mglScale
   unit="metric"
   position="bottom-right">
  </mgl-control>

  <mgl-raster-source
    *ngFor="let source of thisMap?.mapbox?.sources"
    [id]="source.source"
    [url]="source.url">
  </mgl-raster-source>

  <mgl-layer
    *ngFor="let layer of thisMap?.mapbox?.layers"
    [id]="layer.id"
    [type]="layer.type"
    [source]="layer.source">
  </mgl-layer>

  <ng-container *ngIf="thisMap?.images">

    <mgl-geojson-source
      id="images"
      [data]="thisMap?.images"
      [cluster]="true"
      [clusterMaxZoom]="18"
      [clusterRadius]="30">
    </mgl-geojson-source>

    <mgl-layer
      id="clusters"
      type="circle"
      source="images"
      (layerMouseEnter)="cursorStyle = 'pointer'"
      (layerMouseLeave)="cursorStyle = 'default'"
      (layerClick)="clusterClick($event)"
      [filter]="['has', 'point_count']"
      [paint]="{
            'circle-color': {
              property: 'point_count',
              type: 'interval',
              stops: [
                [0, '#f1f075'],
              ]
            },
            'circle-radius': {
              property: 'point_count',
              type: 'interval',
              stops: [
                [0, 17],
                [5, 18],
                [6, 19],
                [7, 20],
                [8, 21],
                [9, 22],
                [10, 23],
                [12, 24],
                [15, 25],
                [20, 27],
              ]
            }
          }"
    >
    </mgl-layer>

    <mgl-layer
      id="cluster-count"
      type="symbol"
      source="images"
      [filter]="['has', 'point_count']"
      [layout]="{
            'text-field': '{point_count_abbreviated}',
            'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],
            'text-size': 12
          }"
    >
    </mgl-layer>

<!--    <mgl-layer-->
<!--      id="unclustered-point"-->
<!--      type="circle"-->
<!--      source="images"-->
<!--      [filter]="['!has', 'point_count']"-->
<!--      [paint]="{-->
<!--        'circle-radius': 15,-->
<!--        'circle-stroke-width': 0,-->
<!--        'circle-stroke-color': '#fff',-->
<!--        'circle-color': [-->
<!--          'match',-->
<!--          ['get', 'format'],-->
<!--          '360',-->
<!--          '#51bbd6',-->
<!--          '180',-->
<!--          '#f1f075',-->
<!--          'pic',-->
<!--          '#f28cb1',-->
<!--          '#000000'-->
<!--          ]-->
<!--      }"-->
<!--    >-->
<!--    </mgl-layer>-->

<!--    <mgl-layer-->
<!--      id="unclustered-count"-->
<!--      type="symbol"-->
<!--      source="images"-->
<!--      [filter]="['!has', 'point_count']"-->
<!--      [layout]="{-->
<!--            'icon-image': [-->
<!--                'match',-->
<!--                ['get', 'format'],-->
<!--                '360',-->
<!--                '360_black_24dp',-->
<!--                '180',-->
<!--                'panorama_horizontal_black_24dp',-->
<!--                'pic',-->
<!--                'crop_original_black_24dp',-->
<!--                'crop_original_black_24dp',-->
<!--            ]-->
<!--          }"-->
<!--    >-->
<!--    </mgl-layer>-->

  </ng-container>

  <mgl-image *ngFor="let format of formats  | keyvalue"
             [id]="format.value['iconId']"
             [url]="format.value.marker"
             (imageLoaded)="imageLoaded(format.key, format.value['iconId'])">
  </mgl-image>

  <mgl-layer *ngIf="markerImagesLoaded"
     id="markers"
     type="symbol"
     source="images"
     (layerMouseEnter)="cursorStyle = 'pointer'"
     (layerMouseLeave)="cursorStyle = 'default'"
     (layerClick)="imageClick($event)"
     [layout]="{
          'icon-image': [
              'match',
              ['get', 'format'],
              '360',
              'icon-360',
              '180',
              'icon-180',
              'pic',
              'icon-pic',
              'icon-pic',
          ]
          }"
     [filter]="['all',['!has', 'point_count']]"
  ></mgl-layer>

>

<mgl-popup
  [closeButton]="false"
  [closeOnClick]="true"
  [feature]="popupFeature">{{ popupHtml }}</mgl-popup>

</mgl-map>

<app-console id="home-console"></app-console>



